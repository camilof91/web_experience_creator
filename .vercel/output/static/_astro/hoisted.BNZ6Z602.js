const T=(e,t)=>{const n=localStorage.getItem(e);if(!n){const a=[t];localStorage.setItem(e,JSON.stringify(a));return}const o=JSON.parse(n),r=o.findIndex(a=>a.id===t.id);if(r!==-1){o[r]=t,localStorage.setItem(e,JSON.stringify(o));return}o.push(t),localStorage.setItem(e,JSON.stringify(o))},L=(e,t)=>{const n=localStorage.getItem(e);return n?JSON.parse(n).find(a=>Object.keys(t).every(s=>a[s]===t[s])):void 0},O=(e,t,n)=>{const o=localStorage.getItem(e);if(!o)return console.error(`La colección '${e}' no existe en localStorage.`),!1;let r=JSON.parse(o);const a=r.find(s=>Object.keys(t).every(i=>s[i]===t[i]));return a?(Object.assign(a,n),localStorage.setItem(e,JSON.stringify(r)),!0):(console.error(`No se encontró ningún documento que coincida con el criterio en la colección '${e}'.`),!1)},B=(e,t)=>{const n=localStorage.getItem(e);if(!n)return console.error(`La colección '${e}' no existe en localStorage.`),0;let o=JSON.parse(n);const r=o.filter(s=>!Object.keys(t).every(i=>s[i]===t[i])),a=o.length-r.length;return localStorage.setItem(e,JSON.stringify(r)),a},C=(e,t)=>{const n=[{opacity:1,transform:"scale(1)",filter:"brightness(1)"},{opacity:.7,transform:"scale(0.9)",filter:"brightness(1.2)"},{opacity:.5,transform:"scale(0.8)",filter:"brightness(1.5)"},{opacity:.3,transform:"scale(0.7)",filter:"brightness(1.7)"},{opacity:1,transform:"scale(1.2)",filter:"brightness(2)",offset:.6},{opacity:.7,transform:"scale(1.1)",filter:"brightness(1.5)"},{opacity:1,transform:"scale(1)",filter:"brightness(1)"}];e.animate(n,{duration:t.duration,iterations:t.iterations,easing:t.easing,delay:t.delay||0})},H=e=>{e.forEach(t=>{if(t instanceof HTMLInputElement||t instanceof HTMLButtonElement){const n=t.getAttribute("data-path");if(n.includes("style")){const o=k();if(o){const r=new Function("cssRule",`return cssRule.${n};`),{variable:a,scheme:s,startsWith:i,endsWith:l}=t.dataset;if((!a||!s)&&M(t,r(o)??t.getAttribute("placeholder")??""),a&&s){const g=new Function("cssRule","value",`cssRule.${n} = value;`),h=o.style.getPropertyValue(`--${a}`)??t.getAttribute("placeholder")??"";g(o,s.replace(/\n|\s+/g,""));const c=h.startsWith(i)?h.slice(i.length):h,u=c.endsWith(l)?c.slice(0,c.length-l.length):c;M(t,u)}}}if(!n.includes("style")){const o=L("selections",{type:"element"});if(!o)return;const r=document.querySelector(`[id="${o.id}"]`),a=new Function("element",`return element.${n}`);t.value=a(r)}}})},N=e=>{const t=L("selections",{type:"element"});if(!t)return;const n=document.querySelector(`[id="${t.id}"]`),o=document.querySelector(`[id="${n.dataset.style}"]`);if(!o||!o.sheet)return;const r=Array.from(o.sheet.cssRules);let a=!1;const s=r.map(i=>i instanceof CSSStyleRule&&i.selectorText===e.selectorText?(a=!0,e):i);for(a||s.push(e);o.sheet.cssRules.length>0;)o.sheet.deleteRule(0);o.innerHTML=s.map(({cssText:i})=>i).join(`
`)},k=()=>{const e=L("selections",{type:"element"});if(!e)return;const t=document.querySelector(`[id="${e.id}"]`),n=document.querySelector(`[id="${t.dataset.style}"]`);if(!n.sheet)return null;const o=n.sheet.cssRules;for(let r=0;r<o.length;r++){const a=o[r];if(a instanceof CSSStyleRule&&a.selectorText.includes(`[data-style="${n.id}"]`))return a}return null};function U(e,t){const n=Date.now(),o=e.offsetWidth,r=setInterval(()=>{const a=Date.now()-n,s=Math.min(a/t,1),i=o*(1-s);e.style.width=`${i}px`,s===1&&(e.style.width="0px",clearInterval(r))},12)}const R=e=>()=>{const t=document.querySelector(".tools.aside.hidden"),n=document.querySelector(".toggle-right-bar"),o=document.querySelector("#selector-line-left"),r=document.querySelector("#selector-line-top"),a=document.querySelector("#selector-line-right"),s=document.querySelector("#selector-line-bottom"),{x:i,y:l,width:g,height:h}=e.getBoundingClientRect(),c=Math.min(s.clientHeight||100,s.clientWidth||100);o.style.left=`${i}px`,o.style.top=`${l-c}px`,a.style.left=`${i+g+c}px`,a.style.top=`${l+h}px`,r.style.left=`${i-c}px`,r.style.top=`${l-c*2}px`,s.style.left=`${i+g+c}px`,s.style.top=`${l+h}px`,o.style.width=`${h}px`,r.style.width=`${g}px`,a.style.width=`${h}px`,s.style.width=`${g}px`,U(o,2e3),U(a,2e3),U(r,2e3),U(s,2e3),t&&n.click(),O("selections",{type:"element"},{type:"element",id:e.id})||T("selections",{type:"element",id:e.id});const y=document.querySelector(".tools"),v=Array.from(y.querySelectorAll("[data-path]"));H(v)},j=e=>e instanceof HTMLInputElement?e.type==="checkbox"||e.type==="radio"?"change":"input":e instanceof HTMLTextAreaElement?"input":e instanceof HTMLSelectElement?"change":e instanceof HTMLButtonElement||e instanceof HTMLFormElement?"click":"input",W=e=>e instanceof HTMLInputElement?e.type==="checkbox"||e.type==="radio"?e.checked&&e.dataset.value:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:e instanceof HTMLButtonElement?e.innerText:null,M=(e,t)=>{if(e instanceof HTMLInputElement){if(e.type==="checkbox"||e.type==="radio"){e.checked=!!t;return}e.value=t;return}if(e instanceof HTMLTextAreaElement){e.value=t;return}if(e instanceof HTMLSelectElement){e.value=t;return}if(e instanceof HTMLButtonElement){e.innerText=t;return}},z=e=>{e.forEach(t=>{t.addEventListener(j(t),()=>{const n=t.getAttribute("data-path"),o=t.dataset.variable,r=t.dataset.scheme,a=t.dataset.startsWith,s=t.dataset.endsWith,i=W(t);if(n.includes("style")){const l=k();l&&(o&&r&&l.style.setProperty(`--${o}`,`${a??""}${i}${s??""}`),(!o||!r)&&new Function("cssRule","value",`cssRule.${n} = value;`)(l,`${a??""}${i}${s??""}`)),N(l),console.log(l)}if(!n.includes("style")){const l=L("selections",{type:"element"});if(!l)return;const g=document.querySelector(`[id="${l.id}"]`);new Function("element","value",`element.${n} = value;`)(g,i)}}),t.addEventListener("blur",()=>{t.classList.remove("selected")}),t.addEventListener("focus",()=>{t.classList.add("selected")})})};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".tools"),t=Array.from(e.querySelectorAll("[data-path]"));z(t)});const F=[{id:crypto.randomUUID(),type:"input",name:"Texto",text:"",attributes:{type:"text",id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"input",name:"Check",text:"",attributes:{type:"checkbox",id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"input",name:"Radio",text:"",attributes:{type:"radio",id:crypto.randomUUID(),name:"radioGroup"}},{id:crypto.randomUUID(),type:"input",name:"Fecha",text:"",attributes:{type:"date",id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"input",name:"Email",text:"",attributes:{type:"email",id:crypto.randomUUID(),placeholder:"nombre@ejemplo.com"}},{id:crypto.randomUUID(),type:"input",name:"Contraseña",text:"",attributes:{type:"password",id:crypto.randomUUID(),placeholder:"Contraseña segura"}},{id:crypto.randomUUID(),type:"div",name:"Box",text:"Contenido del div",attributes:{contentEditable:"true",id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"span",name:"Span",text:"Contenido del span",attributes:{id:crypto.randomUUID(),style:"font-weight: bold;"}},{id:crypto.randomUUID(),type:"p",name:"Párrafo",text:"Texto del párrafo",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"h1",name:"Encabezado H1",text:"Título H1",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"h2",name:"Encabezado H2",text:"Título H2",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"h3",name:"Encabezado H3",text:"Título H3",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"h4",name:"Encabezado H4",text:"Título H4",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"h5",name:"Encabezado H5",text:"Título H5",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"h6",name:"Encabezado H6",text:"Título H6",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"ul",name:"Unordered List",text:"",attributes:{id:crypto.randomUUID()},children:[{id:crypto.randomUUID(),type:"li",name:"List Item 1",text:"Item 1",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"li",name:"List Item 2",text:"Item 2",attributes:{id:crypto.randomUUID()}}]},{id:crypto.randomUUID(),type:"ol",name:"Ordered List",text:"",attributes:{id:crypto.randomUUID()},children:[{id:crypto.randomUUID(),type:"li",name:"List Item 1",text:"Item 1",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"li",name:"List Item 2",text:"Item 2",attributes:{id:crypto.randomUUID()}}]},{id:crypto.randomUUID(),type:"img",name:"Imagen",text:"",attributes:{id:crypto.randomUUID(),src:"path_to_image.jpg",alt:"Descripción de la imagen",style:"max-width: 100%;"}},{id:crypto.randomUUID(),type:"video",name:"Video",text:"",attributes:{id:crypto.randomUUID(),width:"320",height:"240",controls:"true"},children:[{id:crypto.randomUUID(),type:"source",name:"Video MP4",attributes:{src:"video.mp4",type:"video/mp4"}},{id:crypto.randomUUID(),type:"source",name:"Video WEBM",attributes:{src:"video.webm",type:"video/webm"}}]},{id:crypto.randomUUID(),type:"audio",name:"Audio",text:"",attributes:{id:crypto.randomUUID(),controls:"true"},children:[{id:crypto.randomUUID(),type:"source",name:"Audio MP3",attributes:{src:"audio.mp3",type:"audio/mp3"}},{id:crypto.randomUUID(),type:"source",name:"Audio OGG",attributes:{src:"audio.ogg",type:"audio/ogg"}}]},{id:crypto.randomUUID(),type:"iframe",name:"iFrame",text:"",attributes:{id:crypto.randomUUID(),src:"https://mancii.com/",width:"320",height:"240"}},{id:crypto.randomUUID(),type:"canvas",name:"Canvas",text:"",attributes:{id:crypto.randomUUID(),width:"800",height:"600"}},{id:crypto.randomUUID(),type:"a",name:"Enlace",text:"Texto del enlace",attributes:{id:crypto.randomUUID(),href:"https://mancii.com",target:"_blank",rel:"noopener noreferrer"}},{id:crypto.randomUUID(),type:"nav",name:"Navegación",text:"",attributes:{id:crypto.randomUUID()},children:[{id:crypto.randomUUID(),type:"a",name:"NavLink1",text:"Enlace 1",attributes:{id:crypto.randomUUID(),href:"#enlace1"}},{id:crypto.randomUUID(),type:"a",name:"NavLink2",text:"Enlace 2",attributes:{id:crypto.randomUUID(),href:"#enlace2"}}]},{id:crypto.randomUUID(),type:"fieldset",name:"Fieldset",text:"",attributes:{id:crypto.randomUUID()},children:[{id:crypto.randomUUID(),type:"legend",name:"Legend",text:"Título del grupo de campos",attributes:{id:crypto.randomUUID()}},{id:crypto.randomUUID(),type:"input",name:"Texto",text:"",attributes:{type:"text",id:crypto.randomUUID(),placeholder:"Ingrese texto"}},{id:crypto.randomUUID(),type:"input",name:"Check",text:"",attributes:{type:"checkbox",id:crypto.randomUUID()}}]},{id:crypto.randomUUID(),type:"datalist",name:"Datalist",text:"",attributes:{id:crypto.randomUUID()},children:[{id:crypto.randomUUID(),type:"option",name:"Opción 1",text:"Opción 1",attributes:{value:"opcion1"}},{id:crypto.randomUUID(),type:"option",name:"Opción 2",text:"Opción 2",attributes:{value:"opcion2"}}]},{id:crypto.randomUUID(),type:"svg",name:"SVG",text:"",attributes:{id:crypto.randomUUID(),width:"100",height:"100",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg"},children:[{id:crypto.randomUUID(),type:"circle",name:"Circle",text:"",attributes:{cx:"50",cy:"50",r:"40",stroke:"black","stroke-width":"3",fill:"red"}},{id:crypto.randomUUID(),type:"rect",name:"Rectangle",text:"",attributes:{x:"10",y:"10",width:"30",height:"30",stroke:"blue","stroke-width":"2",fill:"yellow"}},{id:crypto.randomUUID(),type:"path",name:"Path",text:"",attributes:{d:"M 10 80 C 40 10, 65 10, 95 80 S 150 150, 180 80",stroke:"green","stroke-width":"2",fill:"none"}}]}],V=e=>{const t=e.getAttribute("data-relation-element"),n=document.getElementById(t);n&&n.remove(),e.remove()},w=(e,t)=>{const n=()=>{if(!e||!t)return;t.innerHTML="";const r={},a=(i,l=0)=>{const g=document.createElement("li");g.classList.add("sidebar__item"),g.style.marginLeft=`${l*20}px`;const h=i.tagName.toLowerCase();r[h]||(r[h]=0),r[h]++;const c=document.createElement("span");c.textContent=`${h} ${r[h]}`,g.appendChild(c),g.draggable=!0;const u=document.createElement("button");u.classList.add("delete-button"),u.style.backgroundImage=`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1rem' height='1rem' viewBox='0 0 20 20'%3E%3Cpath fill='%23e20c0c' d='M8.5 4h3a1.5 1.5 0 0 0-3 0m-1 0a2.5 2.5 0 0 1 5 0h5a.5.5 0 0 1 0 1h-1.054l-1.194 10.344A3 3 0 0 1 12.272 18H7.728a3 3 0 0 1-2.98-2.656L3.554 5H2.5a.5.5 0 0 1 0-1zM5.741 15.23A2 2 0 0 0 7.728 17h4.544a2 2 0 0 0 1.987-1.77L15.439 5H4.561zM8.5 7.5A.5.5 0 0 1 9 8v6a.5.5 0 0 1-1 0V8a.5.5 0 0 1 .5-.5M12 8a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z'/%3E%3C/svg%3E")`,u.style.backgroundSize="contain",u.style.backgroundRepeat="no-repeat",u.style.width="24px",u.style.height="24px",u.style.border="none",u.style.cursor="pointer",u.addEventListener("click",f=>{f.stopPropagation(),V(g)}),g.appendChild(u);let y=i.id;y||(y=`element-${Math.random().toString(36).substr(2,9)}`,i.id=y),g.setAttribute("data-relation-element",y);const v=Array.from(i.children);if(v.length>0){const f=document.createElement("ul");f.classList.add("sidebar__sublist"),v.forEach(b=>{f.appendChild(a(b,l+1))}),g.appendChild(f)}return g};Array.from(e.children).forEach(i=>{t.appendChild(a(i))});const s=t.querySelectorAll(".sidebar__item");J(s)},o=new MutationObserver(n);e&&o.observe(e,{childList:!0,subtree:!0}),n()},J=e=>{e.forEach(t=>{t.addEventListener("dragstart",n=>{n.dataTransfer.setData("text/plain",t.getAttribute("data-relation-element")),t.classList.add("dragging")}),t.addEventListener("dragend",()=>{t.classList.remove("dragging")}),t.addEventListener("dragover",n=>{n.preventDefault();const o=document.querySelector(".dragging"),r=P(t.parentElement,n.clientY);r==null?t.parentElement.appendChild(o):t.parentElement.insertBefore(o,r)}),t.addEventListener("drop",n=>{n.preventDefault();const o=n.dataTransfer.getData("text"),r=document.querySelector(`[data-relation-element="${o}"]`);if(r&&t!==r){const a=t.querySelector(".sidebar__sublist")||document.createElement("ul");a.classList.add("sidebar__sublist"),a.appendChild(r),t.querySelector(".sidebar__sublist")||t.appendChild(a)}})})},P=(e,t)=>[...e.querySelectorAll(".sidebar__item:not(.dragging)")].reduce((o,r)=>{const a=r.getBoundingClientRect(),s=t-a.top-a.height/2;return s<0&&s>o.offset?{offset:s,element:r}:o},{offset:Number.NEGATIVE_INFINITY}).element,I=()=>{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();{const e=Math.random().toString(36).slice(2,10),t=Math.random().toString(36).slice(2,6);return`${e}-${t}-4`}},q=e=>{const t=document.createElement(e.type);return e.attributes&&Object.keys(e.attributes).forEach(n=>{t.setAttribute(n,e.attributes[n])}),e.text&&e.text.trim().length>0&&(t.textContent=e.text),e.children&&e.children.length>0&&e.children.forEach(n=>{const o=q(n);t.appendChild(o)}),t.id=I(),t.dataset.elementType=e.type,t.addEventListener("dblclick",R(t)),t},G=()=>{const e=I(),t=document.createElement("style");return t.id=e,t},K=e=>`data-style="${e}"`,Y=e=>`[${K(e)}] {}`,Q=e=>{const t=G();return e.setAttribute("data-style",t.id),t.innerHTML=Y(t.id),{element:e,style:t}},Z=e=>{const t=document.createElement("li");return t.classList.add("sidebar__item"),t.textContent=e.name,t.dataset.info=JSON.stringify(e),t.dataset.id=e.id,t.id=e.id,t.setAttribute("draggable","true"),t.addEventListener("dragstart",n=>{console.log("Arrastre comenzo para",e.name,n),t.classList.add("dragging"),n.dataTransfer.setData("application/json",JSON.stringify(e))}),t.addEventListener("dragend",n=>{console.log("El arrastre terminó para",e.name,n),t.classList.remove("dragging")}),t.addEventListener("click",n=>{console.log("Me estas tocando "+e.name,n)}),t},X=()=>{const e=document.querySelector("main.canvas");e.addEventListener("dragover",t=>{t.preventDefault()}),e.addEventListener("drop",t=>{t.preventDefault();const n=t.target,o=document.querySelector(".canvas__tab--active"),r=n.closest(`.canvas__content#tab-content-${o.dataset.tab}`),a=document.querySelector("#canvas__styles");if(r){const s=t.dataTransfer.getData("application/json"),i=JSON.parse(s),l=q(i),{element:g,style:h}=Q(l);if(n.appendChild(g),a.appendChild(h),l.closest(`.canvas__content#tab-content-${o.dataset.tab}`)===r){T("elements-added",{id:l.id});const c=document.querySelector("#layer_list");c instanceof HTMLElement&&w(r,c)}}})},ee=(e,t)=>{e.innerHTML="",t.forEach(n=>e.appendChild(n))},te=e=>{const t=document.createElement("button");t.classList.add("toggle-sidebar-button");const n=document.getElementById(e);if(!n)throw new Error(`No se encontró el elemento con ID ${e}`);const o=`
  <svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24">
    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor">
      <path d="M2 12c0-3.75 0-5.625.955-6.939A5 5 0 0 1 4.06 3.955C5.375 3 7.251 3 11 3h2c3.75 0 5.625 0 6.939.955a5 5 0 0 1 1.106 1.106C22 6.375 22 8.251 22 12s0 5.625-.955 6.939a5 5 0 0 1-1.106 1.106C18.625 21 16.749 21 13 21h-2c-3.75 0-5.625 0-6.939-.955a5 5 0 0 1-1.106-1.106C2 17.625 2 15.749 2 12m7.5-8.5v17M5 7h1.5M5 11h1.5" />
      <path d="m17 10l-1.226 1.057c-.516.445-.774.667-.774.943s.258.498.774.943L17 14" />
    </g>
  </svg>
  `,r=`
  <svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24">
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2 12c0-3.69 0-5.534.814-6.841a4.8 4.8 0 0 1 1.105-1.243C5.08 3 6.72 3 10 3h4c3.28 0 4.919 0 6.081.916c.43.338.804.759 1.105 1.243C22 6.466 22 8.31 22 12s0 5.534-.814 6.841a4.8 4.8 0 0 1-1.105 1.243C18.92 21 17.28 21 14 21h-4c-3.28 0-4.919 0-6.081-.916a4.8 4.8 0 0 1-1.105-1.243C2 17.534 2 15.69 2 12m7.5-9v18M5 7h1m-1 3h1" color="currentColor" />
  </svg>
  `,a=document.createElement("div");return a.innerHTML=o,a.classList.add("icon"),t.appendChild(a),t.addEventListener("click",()=>{n.classList.contains("hidden")?(n.classList.remove("hidden"),a.innerHTML=o):(n.classList.add("hidden"),a.innerHTML=r)}),t},ne=e=>{const t=document.createElement("button");t.classList.add("toggle-right-bar");const n=document.getElementById(e);if(!n)throw new Error(`No se encontró el elemento con ID ${e}`);const o=`
  <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" viewBox="0 0 24 24">
    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor">
      <path d="M22 12c0-3.75 0-5.625-.955-6.939a5 5 0 0 0-1.106-1.106C18.625 3 16.749 3 13 3h-2c-3.75 0-5.625 0-6.939.955A5 5 0 0 0 2.955 5.06C2 6.375 2 8.251 2 12s0 5.625.955 6.939a5 5 0 0 0 1.106 1.106C5.375 21 7.251 21 11 21h2c3.75 0 5.625 0 6.939-.955a5 5 0 0 0 1.106-1.106C22 17.625 22 15.749 22 12m-7.5-8.5v17M19 7h-1.5m1.5 4h-1.5" />
      <path d="m8 10l1.227 1.057c.515.445.773.667.773.943s-.258.498-.773.943L8 14" />
    </g>
  </svg>
  `,r=`
  <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" viewBox="0 0 24 24">
	<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2 12c0-3.69 0-5.534.814-6.841a4.8 4.8 0 0 1 1.105-1.243C5.08 3 6.72 3 10 3h4c3.28 0 4.919 0 6.081.916c.43.338.804.759 1.105 1.243C22 6.466 22 8.31 22 12s0 5.534-.814 6.841a4.8 4.8 0 0 1-1.105 1.243C18.92 21 17.28 21 14 21h-4c-3.28 0-4.919 0-6.081-.916a4.8 4.8 0 0 1-1.105-1.243C2 17.534 2 15.69 2 12m12.5-9v18M18 7h1m-1 3h1" color="currentColor" />
</svg>
  `,a=document.createElement("div");return a.innerHTML=o,a.classList.add("icon"),t.appendChild(a),t.addEventListener("click",()=>{n.classList.contains("hidden")?(n.classList.remove("hidden"),a.innerHTML=o):(n.classList.add("hidden"),a.innerHTML=r)}),t};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#sidebar_components"),t=F.map(Z);ee(e,t);const n="sidebar",o=document.getElementById("toggleLeftBar");if(o){const s=te(n);o.replaceWith(s)}else console.error("No se encontró el botón de toggle");const r="rightbar",a=document.getElementById("toggleRightBar");if(a){const s=ne(r);a.replaceWith(s)}else console.error("No se encontró el botón de toggle")});document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#grid-column-settings"),t=document.querySelector("#grid-row-settings"),n=document.querySelector("#add-column-btn"),o=document.querySelector("#add-row-btn"),r=document.querySelectorAll('.grid-column-setting input[type="number"]'),a=document.querySelectorAll(".grid-column-setting select"),s=document.querySelectorAll('.grid-row-setting input[type="number"]'),i=document.querySelectorAll(".grid-row-setting select"),l=(d,p,m)=>{console.log(`Updating ${p} with id ${m} to value ${d}`)};r.forEach(d=>{d.addEventListener("change",p=>{const m=p.target;l(m.value,"column",d.id)}),d.addEventListener("input",p=>{const m=p.target;l(m.value,"column",d.id)})}),s.forEach(d=>{d.addEventListener("change",p=>{const m=p.target;l(m.value,"row",d.id)}),d.addEventListener("input",p=>{const m=p.target;l(m.value,"row",d.id)})}),a.forEach(d=>{d.addEventListener("change",p=>{const m=p.target;l(m.value,"column",d.id)})}),i.forEach(d=>{d.addEventListener("change",p=>{const m=p.target;l(m.value,"row",d.id)})});const g=(d,p)=>{const m=document.createElement("input");m.type="number";const E={min:{value:"0",text:"Minimum"},max:{value:"100",text:"Maximum"}};return m.min=E.min.value,m.max=E.max.value,m.value=p,m.id=`column-input-${d}`,m.name=`column-${d}`,m},h=d=>{const p=document.createElement("select");return p.id=`column-select-${d}`,p.name=`column-${d}`,Object.entries({"%":"percentage",px:"pixels",auto:"auto",fr:"flex unit",vw:"viewport width",em:"ems",rem:"root ems"}).forEach(([E,S])=>{const x=document.createElement("option");x.value=E,x.text=S,p.appendChild(x)}),p},c=(d,p)=>{const m=document.createElement("input");m.type="number";const E={min:{value:"0",text:"Minimum"},max:{value:"100",text:"Maximum"}};return m.min=E.min.value,m.max=E.max.value,m.value=p,m.id=`row-input-${d}`,m.name=`row-${d}`,m},u=d=>{const p=document.createElement("select");return p.id=`row-select-${d}`,p.name=`row-${d}`,Object.entries({"%":"percentage",px:"pixels",auto:"auto",fr:"flex unit",vw:"viewport width",em:"ems",rem:"root ems"}).forEach(([E,S])=>{const x=document.createElement("option");x.value=E,x.text=S,p.appendChild(x)}),p};let y=1,v=1;const f=()=>{const d=document.createElement("div");d.className="grid-column-setting";const p=g(y,1),m=h(y);d.appendChild(p),d.appendChild(m),e.appendChild(d),y++},b=()=>{const d=document.createElement("div");d.className="grid-row-setting";const p=c(v,1),m=u(v);d.appendChild(p),d.appendChild(m),t.appendChild(d),v++};n.addEventListener("click",f),o.addEventListener("click",b)});document.getElementById("add-shadow")?.addEventListener("click",()=>{document.getElementById("shadow-offset-x").value,document.getElementById("shadow-offset-x-unit").value,document.getElementById("shadow-offset-y").value,document.getElementById("shadow-offset-y-unit").value,document.getElementById("shadow-blur").value,document.getElementById("shadow-blur-unit").value,document.getElementById("shadow-spread").value,document.getElementById("shadow-spread-unit").value,document.getElementById("shadow-color").value});const oe=(e,t)=>{const n=document.querySelector(t);if(!n){console.error(`No se encontró el contenedor con el selector: ${t}`);return}n.innerHTML="";const o=D(e);n.appendChild(o)},D=e=>{const t=document.createElement(e.tagName);for(const[r,a]of Object.entries(e.attributes))t.setAttribute(r,a);for(const r of e.events)t.addEventListener(r.type,r.handler);if(e.tagName==="TextNode")t.textContent=e.textContent;else for(const r of e.children){const a=D(r);t.appendChild(a)}const n=document.createElement("style"),o=Object.values(e.rules).flat().join(`
`);return n.innerHTML=o,document.head.appendChild(n),t},re=e=>{const t={};return e.querySelectorAll("input").forEach(r=>{t[r.name??r.id]=r.value}),e.querySelectorAll("select").forEach(r=>{t[r.name??r.id]=r.value}),t},ae=(e,t)=>()=>{switch(e.innerHTML="",t.value){case"event-modal":ue(e);break;case"button-modal":me(e);break;case"element-inject":pe(e);break}},se=()=>{const e=document.createElement("select");return e.id="button-location-select",e.name="button-location",Object.entries(["top-right","top-left","bottom-right","bottom-left"]).forEach(([n,o])=>{const r=document.createElement("option");r.value=n,r.text=o,e.appendChild(r)}),e},A=()=>{const e=document.createElement("input");return e.type="text",e.id="button-text-input",e.name="button-text",e.placeholder="Enter button text",e},ce=()=>{const e=document.createElement("input");return e.type="text",e.id="injection-selector-input",e.name="injection-selector",e.placeholder="Enter element selector",e},ie=()=>{const e=document.createElement("div");e.className="odal";const t=document.createElement("div");t.className="odal-content";const n=document.createElement("div");n.className="odal-header";const o=document.createElement("div");o.className="odal-body";const r=de();o.appendChild(r);const a=le();return o.appendChild(a),t.appendChild(n),t.appendChild(o),e.appendChild(t),e},de=()=>{const e=document.createElement("input");return e.type="text",e.id="event-selector",e.name="event-selector",e.placeholder="Enter event selector",e},le=()=>{const e=document.createElement("select");return e.id="event-type",e.name="event-type",[{value:"click",text:"Click"},{value:"mouseover",text:"Mouse Over"},{value:"mouseout",text:"Mouse Out"},{value:"mousemove",text:"Mouse Move"},{value:"mousedown",text:"Mouse Down"},{value:"mouseup",text:"Mouse Up"},{value:"dblclick",text:"Double Click"},{value:"keydown",text:"Key Down"},{value:"keyup",text:"Key Up"},{value:"keypress",text:"Key Press"},{value:"change",text:"Change"},{value:"input",text:"Input"},{value:"submit",text:"Submit"},{value:"focus",text:"Focus"},{value:"blur",text:"Blur"},{value:"scroll",text:"Scroll"},{value:"resize",text:"Resize"},{value:"animationstart",text:"Animation Start"},{value:"animationend",text:"Animation End"},{value:"animationiteration",text:"Animation Iteration"},{value:"transitionend",text:"Transition End"},{value:"transitionstart",text:"Transition Start"},{value:"touchstart",text:"Touch Start"},{value:"touchend",text:"Touch End"},{value:"touchmove",text:"Touch Move"},{value:"touchcancel",text:"Touch Cancel"},{value:"touchenter",text:"Touch Enter"},{value:"touchleave",text:"Touch Leave"}].forEach(n=>{const o=document.createElement("option");o.value=n.value,o.text=n.text,e.appendChild(o)}),e},ue=e=>{const t=document.createElement("div");t.className="event-setting";const n=ie();t.appendChild(n),e.appendChild(t)},me=e=>{const t=document.createElement("div");t.className="button-setting";const n=se(),o=A();t.appendChild(n),t.appendChild(o),e.appendChild(t)},pe=e=>{const t=document.createElement("div");t.className="injection-setting";const n=ce();t.appendChild(n);const o=A();e.appendChild(o),e.appendChild(t)},ye=e=>{let t="";switch(e.type){case"event-modal":t=`
        document.querySelector('${e["event-selector"]}').addEventListener('${e["event-type"]}', () => {
          restoreDOM(miniDom, "body");
        });
      `;break;case"button-modal":t=`
        const button = document.createElement('button');
        button.innerText = '${e["button-text"]}';
        button.style.position = 'fixed';
        button.style.${e["button-location"].split("-")[0]} = '10px';
        button.style.${e["button-location"].split("-")[1]} = '10px';
        document.body.appendChild(button);
        button.addEventListener('click', () => {
          restoreDOM(miniDom, "body");
        });
      `;break;case"element-inject":t=`
        const element = document.querySelector('${e["injection-selector"]}');
        if (element) {
          const injectContent = document.createElement('div');
          injectContent.innerText = 'Contenido inyectado';
          element.appendChild(injectContent);
          // Ejecutar restoreDOM cuando sea necesario en el contexto del elemento inyectado
          restoreDOM(miniDom, ${e["injection-selector"]});
        }
      `;break}return t},ge=e=>{const t=JSON.stringify(e,null,2),n=document.getElementById("plugin-generator-fieldset"),o=re(n),r=ye(o),a=`
    const miniDom = ${t};
    //aqui va la funcion de la guia,  lo que haga aqui, sera Javascript, aqui no hay tipado.
    const createElementFromMiniDOM = ${D.toString()}
    const restoreDOM = ${oe.toString()}
    ${r}
    `,s=new Blob([a],{type:"application/javascript"}),i=URL.createObjectURL(s),l=document.createElement("a");l.href=i,l.download="experience_plugin_mancii.js",document.body.appendChild(l),l.click(),document.body.removeChild(l)},_=e=>{const t=he(e);return ve(e,t),xe(e,t,_),Ee(e,t),t.rules=be(t.styleId),t},he=e=>({tagName:e.tagName.toLowerCase(),attributes:{},children:[],styles:{},events:[],className:{},rules:{},styleId:e.dataset.style,textContent:""}),ve=(e,t)=>{for(let n=0;n<e.attributes.length;n++){const o=e.attributes[n];o.name.toLowerCase()!=="contentEditable"&&(t.attributes[o.name]=o.value)}},fe=e=>{if(typeof e!="string")throw new Error(`El ID no es una cadena válida: ${e}`);return e.replace(/([#;&,.+*~':"!^$[\]()=>|/@])/g,"\\$1")},be=e=>{if(!e)return console.warn("El ID del estilo es undefined o null."),{};const t=fe(e),n=document.querySelector(`[id="${t}"]`),o={clases:[]},r=new Map([]);if(!n)return console.warn(`No se encontró la etiqueta <style> con ID: ${e}`),o;for(const a of Array.from(n.sheet.cssRules))if(r.has(a.constructor)){const s=r.get(a.constructor);o[s]?.push(a.cssText)}else o.clases?.push(a.cssText);return o},Ee=(e,t)=>{Object.keys(e).forEach(o=>{const r=e[o];typeof r=="function"&&t.events.push({type:o,handler:()=>{e.addEventListener(o,a=>{r(a)})}})})},xe=(e,t,n)=>{for(let o=0;o<e.childNodes.length;o++){const r=e.childNodes[o];if(r instanceof HTMLElement){const a=n(r);t.children.push(a)}else r instanceof Text&&t.children.push({tagName:"TextNode",attributes:{},children:[],styles:{},events:[],className:{},rules:{},styleId:"",textContent:r.textContent?.trim()||""})}};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#dynamic-inputs-container"),t=document.querySelector("#generation-type");t.addEventListener("change",ae(e,t))});document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#plugin-generator");if(!e){console.error('No se encontró el botón con ID "plugin-generator".');return}e.addEventListener("click",()=>{const t=document.querySelector(".canvas__content--active");if(!t){console.error('No se encontró el elemento con clase "canvas__content--active".');return}const n=_(t);ge(n)})});const Ue=(e,t)=>{e.forEach(n=>{n.addEventListener("click",()=>{e.forEach(a=>a.classList.remove("canvas__tab--active")),t.forEach(a=>a.classList.remove("canvas__content--active")),n.classList.add("canvas__tab--active");const o=document.querySelector(`#tab-content-${n.dataset.tab}`),r=document.querySelector("#layer_list");o&&o.classList.add("canvas__content--active"),o&&r&&w(o,r)})})};document.addEventListener("DOMContentLoaded",()=>{const e=Array.from(document.querySelectorAll(".canvas__tab")),t=Array.from(document.querySelectorAll(".canvas__content"));Ue(e,t)});document.addEventListener("DOMContentLoaded",X);const Ie=(e,t)=>new Promise((n,o)=>{const r=indexedDB.open(e,t);r.onupgradeneeded=a=>{const s=a.target.result;s.objectStoreNames.contains("resources")||s.createObjectStore("resources",{keyPath:"id",autoIncrement:!0})},r.onsuccess=a=>{const s=a.target.result;n(s)},r.onerror=a=>{o(`Error opening database: ${a.target.error}`)}}),Le=(e,t)=>new Promise((n,o)=>{const s=e.transaction(["resources"],"readwrite").objectStore("resources").add(t);s.onsuccess=()=>{n()},s.onerror=i=>{o(`Error adding resource: ${i.target.error}`)}}),Se=e=>new Promise((t,n)=>{const a=e.transaction(["resources"],"readonly").objectStore("resources").getAll();a.onsuccess=()=>{t(a.result)},a.onerror=s=>{n(`Error getting resources: ${s.target.error}`)}}),we=async()=>{const e=document.getElementById("fileInput"),t=document.getElementById("resourceList"),n=document.getElementById("canvas"),o=await Ie("manciiDB",1),r=async()=>{t.innerHTML="";const c=await Se(o),u=new Set;c.forEach((y,v)=>{if(!u.has(y.id)){const f=a(y),b=document.createElement("li");b.classList.add("sidebar__item"),b.textContent=`${f.type}: ${f.name}`,b.draggable=!0,b.setAttribute("data-resource-content",l(f)),$(f.type,f.attributes),t.appendChild(b),u.add(y.id),g(b,f)}})},a=c=>{const{name:u,content:y}=c,v=I(),f=s(y),b=i(y);switch(f){case"img":case"label":case"iframe":return{id:v,type:f,name:u,attributes:b};case"video":return{id:v,type:"video",name:u,attributes:b,sources:[{src:y,type:y.split(";")[0].split(":")[1]}]};case"audio":return{id:v,type:"audio",name:u,attributes:b,sources:[{src:y,type:y.split(";")[0].split(":")[1]}]};case"unknown":default:return{id:v,type:"unknown",name:u,attributes:b}}},s=c=>c.startsWith("data:image")?"img":c.startsWith("data:video")?"video":c.startsWith("data:audio")?"audio":c.startsWith("data:text")?"label":c.startsWith("application/pdf")||c.startsWith("application/msword")||c.startsWith("application/vnd.ms-excel")||c.startsWith("application/vnd.ms-powerpoint")||c.startsWith("application/vnd.openxmlformats-officedocument")?"iframe":"unknown",i=c=>{const u={id:I(),src:c};return c.startsWith("data:image")&&(u.alt=c.split(",")[0].split(";")[0].split(":")[1]),c.startsWith("data:text")&&(u.text=atob(c.split(",")[1])),u},l=c=>{switch(c.type){case"video":case"audio":return c.sources[0].src;default:return c.attributes?.src??""}},g=(c,u)=>{c.addEventListener("dragstart",y=>{console.log(u),y.dataTransfer.setData("application/json",JSON.stringify(u)),c.classList.add("dragging")}),c.addEventListener("dragend",()=>{c.classList.remove("dragging")})};e.addEventListener("change",async c=>{const u=c.target.files;if(u)for(let y of u){const v=new FileReader;v.onload=async f=>{const b=f.target?.result;b&&(await Le(o,{name:y.name,content:b}),await r())},v.readAsDataURL(y)}}),await r(),n.addEventListener("dragover",c=>{c.preventDefault()}),n.addEventListener("drop",c=>{c.preventDefault();const u=c.dataTransfer.getData("text/plain");h(u,n)});const h=(c,u)=>{const y=a({name:"",content:c}),v=$(y.type,y.attributes);u.appendChild(v)}},$=(e,t)=>{const n=document.createElement(e);return Object.keys(t).forEach(o=>{n.setAttribute(o,t[o])}),n};document.addEventListener("DOMContentLoaded",()=>{we()});document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".canvas__active"),t=document.getElementById("layer_list");e instanceof HTMLElement&&t instanceof HTMLElement&&w(e,t)});function De(){const e=document.querySelectorAll(".nav__item");e.forEach(r=>{r.addEventListener("click",()=>{const a=r.dataset.section.toLowerCase();e.forEach(s=>{s.classList.remove("nav__item--active")}),r.classList.add("nav__item--active"),t(),a==="todos"?n():o(a)})});function t(){document.querySelectorAll(".sidebar__section").forEach(a=>{a.style.display="none"})}function n(){document.querySelectorAll(".sidebar__section").forEach(a=>{a.style.display="block"})}function o(r){const a=document.querySelector(`.sidebar__section[data-section="${r}"]`);a&&(a.style.display="block")}}document.addEventListener("DOMContentLoaded",()=>{De()});B("selections",{type:"element"});document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector('li[data-section="todos"]'),t=document.querySelector('div[data-tab="Mobile"]'),n=document.querySelector(".toggle-sidebar-button"),o=document.querySelector(".toggle-right-bar"),r=document.querySelector("#sidebar_components");setTimeout(()=>{e.click(),t.click(),n.click(),o.click()},0),setTimeout(()=>{n.click(),C(n,{duration:800,iterations:1,easing:"ease-in-out"})},700),setTimeout(()=>{r.click(),Array.from(r.children).forEach((a,s)=>{C(a,{duration:700,iterations:1,easing:"ease-in-out",delay:s*100})})},800)});
